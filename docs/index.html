<html>
<head>
<title>ePubEditor</title>
<meta http-equiv="Content-Type" content="text/html;"/>
</head>
<body><h4>The history of the ePub file format</h4>
<p>The ePub file format had its genesis in 1999 with the publication of the
 <a href="http://web.archive.org/web/20101212183516/http://idpf.org/oebps/oebps1.0/download/oeb1-oebps.htm">Open
 eBook Publication Structure 1.0 (OEBPS)</a> by the Open eBook Forum, a consortium
 of individuals representing publishers, reading system vendors, software
 developers and experts in relevant web standards. A maintenance release of the
 specification was released in July of 2001 to clarify some parts of the original
 specification, but without substantive changes.</p>

<p>Over-simplifying, OEB defined a collection of files that together would comprise
 an e-book, together with a newly invented OEB package file which specifies the OEB
 documents, images, and other files that make up the OEB publication and how they
 relate to each other. According to the specification:</p>
<blockquote>
 <p>"A publication conforming to this specification must include
  exactly one OEB package file, which specifies the OEB documents, images, and other
  objects that make up the OEB publication and how they relate to each other.</p>
  <p>
  It is recommended that all package files use extension ".opf", in order to make
   them readily identifiable within the group of files making up a publication."</p>
</blockquote>
<p>Note
 that the acronym "OPF" originally signified "OEB Package File", and not "Open
 Packaging Format" as the <a href="http://idpf.org/"></a>International Digital
 Publishers Forum (IDPF) subsequently rebranded it.</p>

<p>The Open eBook Forum envisioned that the primary file format in an OEBPS
publication would be HTML (at the time, HTML 4 was the most current version of
HTML).</p>
<p><i>Add argument in favor of XHTML here</i></p>

<p>One of the major shortcomings of the OEBPS was that it did not propose any
 sort of single file publication structure, explicitly stating that "This
 specification does not define means for physically bundling files together
 to make one data transfer object (such as using zip or tar)."</p>

<p>In 2004 I approached Jon Noring, one of the original participants in the Open
 eBook Forum with an idea for an OEBPS container based on the ZIP file format.
 My idea was a fairly simply one similar to that used by the Java Archive (JAR)
 format: as well as including all the OEBPS files in a ZIP archive, it would also
 include a required META-INF folder containing a single file which must be named
 "container.xml" and which would point to the ".opf" file which defined the rest
 of the publication. Potentially, the container.xml file could contain references
 to multiple ".opf" files which would allow multiple publications to exist in
 a single file, but in practice I have never observed that usage.</p>

<p>The purpose of the "container.xml" file was to morph the container file from
 a "data transfer object" into a single file that could be used by ebook reading
 software, as the required "container.xml" file could be used as a known entry
 point into the publication as a whole. To promote this new format, and to develop
 a prototype ebook reading system, Jon and I, together with a few like-minded
 individuals formed the <a href="https://en.wikipedia.org/wiki/OpenReader_Consortium">Open
 Reader Consortium</a>, created a couple of Yahoo discussion groups, and sent
 <a href="https://groups.google.com/g/rec.arts.books/c/3MHa0lh5ea8/m/ETKaE2Nln9IJ">invitations</a>
 to the nascent ebook community to join us.</p>

<p>Unfortunately, the Open Reader Consortium never gained much traction and has
 since been placed in "<a href="http://jonnoring.net/OpenReader/index.html">cold storage</a>."
 It did, however, have a
 <a href="https://web.archive.org/web/20170118033049/http://blogs.adobe.com/billmccoy/2007/01/openreader_vict.html">significant
 impact</a> on the later development of the "ePub" format. The IDPF's specification
 for the "<a href="http://idpf.org/epub/20/spec/OCF_2.0.1_draft.doc">Open
 Container Format</a>" (in which I participated as an "Invited Expert") is,
 in practice, virtually identical to the format I proposed to Jon Noring.
 (The actual specification permits additional but purely optional XML files to
 be added to the META-INF folder. In my somewhat limited experience I have never
 seen a publication that contains more than the required "container.xml" file.)</p>

<p>In January of 2017 the IDPF was <a href="https://www.w3.org/2017/01/pressrelease-idpf-w3c-combination.html.en">merged
 into the W3C</a>, and itself went into cold storage.</p>

<p>In 2011 I started work on this project, <b>ePubEditor</b>, a Java-based project
 using Swing for its user-interface code and designed to edit ePub files in their
 native form. The source code was originally published at
 <a href="https://sourceforge.net/projects/epubeditor/">SourceForge</a>, and more
 recently revived and copied to <a href="https://github.com/lpassey/ePubEditor">GitHub</a>.
 It is my intention moving forward to upgrade the project to JavaFX and add
 whatever additional functionality may be required to support the newest version
 of <a href="https://en.wikipedia.org/wiki/EPUB">ePub</a> (currently 3.2).</p>

<h4><b>ePubEditor</b> purpose and goals</h4>

<p>I have two target audiences for <b>ePubEditor</b>: people who have created
 an e-book in HTML format, and now want a quick and easy way to turn it into an
 ePub, and people who have ePubs that do not display well on their devices because
 of "over-styling" by publishers and who want to clean up those ePubs for their
 own purposes.</p>

<p><b>ePubEditor</b> is designed to be a fairly literal interface into the OEB
 Package File (.opf) which is a required part of every ePub. The package file
 is an XML file that contains sections to describe various parts of an ebook.
 The &lt;manifest&gt; section of the file contains a list of all the files that
 make up the publication, not only XHTML content, but referenced images, CSS
 style sheets, font files, and anything else required to make a complete publication.</p>

<p>The &lt;spine&gt; section of the package file contains links to items in the
 &lt;manifest&gt; which form the primary reading order of the publication. It
 does <em>not</em> contain links to all the items in the manifest, only to those
 which are designed to be presented directly to the reader. These spine items
 can be thought of as "chapters" of the publication. <strong>Order is important
 here</strong>; when an ePub is opened, the content files will be presented to
 the reader in exactly the same order as they appear in this section.</p>

<p>The next section of the package file is the &lt;metadata&gt; section. This
 section contains details <em>about</em> the publication which are not part of
 publication itself, such as the names of the author and contributors, the title
 of the publication, the publisher identity, ISBN numbers and other identifiers.
 The &lt;metadata&gt; section was originally intended to contain only metadata
 defined by the <a href="https://dublincore.org/">Dublin Core Metadata
 Initiative</a> but it has since been expanded to include any arbitrary metadata
 by using the &lt;meta&gt; tag.</p>

<p>Lastly, the package file contains a &lt;guide&gt; section. This section is
 designed to provide links to various significant parts of the publication such
 as the cover image, the start of the text, and any copyright notice. This
 section is intended for the benefit of reading system software, not the reader,
 but I'm not aware of any software (other than perhaps Adobe Digital Editions)
 which takes advantage of this data.</p>

<h4>ePubEditor operation</h4>

<p>When you start the program <b>ePubEditor</b>'s opening screen will have 5
 tabs, roughly corresponding to the publication sections of the .opf file.
 At this point, the current tab will be the Manifest table.</p>

<p>Before attempting to edit any ePub file, you may want to set up your tool
preferences. At the bottom of the Manifest tab there are 5 buttons, one of which
is the "Edit" button. When you select a file on the Manifest tab and press the
"Edit" button it will launch an editor to allow you to edit the file.</p>

<p id="Editor">The selection of an HTML editor is a very personal one. So how does
 <b>ePubEditor</b> know what your preferred editors are? The answer is that
 you tell it. When you select the Tools&#8209;&gt;Editors from the menu bar,
 you will be presented with a dialog box that lists media-types and the
 executables that are used to edit them.</p>

<img src="Editors.png" style="max-width: 95vw" />

<p>To add an editor to this list you must
 know where on your computer the executable file resides. This can sometimes be
 challenging on Windows platforms because Microsoft makes a concerted effort to
 hide this information from you. If you don't know where an executable file is
 found on Windows, find the shortcut you use to launch the application.
 Right&#8209;click on the icon or the program listing in the start menu and select
 "properties". The "Target" value will be the location of the executable. If you
 are a Mac user I can't tell you how to find the location of the executable.
 If someone could help me out I would appreciate it. If you're a Linux user,
 you already know how to find an executable's location.</p>

<p>In the Tools&#8209;>Editors dialog, press the "Add" button. Yet another dialog
 box will open where you can select a media-type that this editor will handle. Press
 the "Browse" button and a file system browser will open that will let you navigate
 to the executable's location in the file system. Select the executable in the
 browser dialog, and press "Select". The path to the executable will be set in
 "Add" dialog. Lastly, edit the command line options, if necessary. "%s" will
 be replaced with the name of the file to be edited; usually this is sufficient,
 but if more command-line options are required you can set them here.</p>

<p>On my system I have set Microsoft's Visual Studio Community Edition with the
 HTML11 extension as my editor for XHTML, IntelliJ IDEA as my editor for HTML,
 and TextPad 5 as my editor for CSS files. These assignments are not exclusive;
 you may use a single application as an editor for all media types, although
 an entry needs to be added for each media-type. Older versions of Microsoft
 Word can work as an HTML editor if you are careful to only use semantic styles
 when editing your files. Avoid Adobe InDesign and most other WYSIWYG editors
 as they tend to focus on presentation and not semantics.</p>

<p>Editors are not limited to text files like HTML. On my system I have set up
 GIMP as my image editor but any image editor that accepts a command-line file
 name could work. I have used IrfanView in the past and it worked well. Microsoft
 Paint is an acceptable alternative. If you have the money you could even use
 Photoshop or PaintShop Pro.</p>

<p>To change an editor selection, remove the old editor listing then add a new
editor selection for that media-type. You cannot edit your selections of the
Tools&#8209;&gt;Editors screen</p>

<p>While you are setting up your editing tools you should also set up other
 preferences. Tools&#8209;>Preferences allows you to set local paths for your
temporary files folder, and your xsl file folder. The purpose of the xsl file
folder will be explained later when we discuss editing existing ePub files. Here
you can also specify the default CSS file that will automatically be added to
all new ePub publications.</p>

<p>Editor and path preferences are stored using the Java Preferences class.
 The backing store for this class is operating system dependent, which means
 the actual mechanism may differ based on the Operating System <b>ePubEditor</b>
 is running on. On Windows preferences are stored in the System Registry,
 whereas on Linux preferences are stored in a file in the user's home directory.
 The upshot of this decision is that the preferences will have to be set for
 every machine that <b>ePubEditor</b> runs on.</p>

<h4>Creating a new publication</h4>

<p>When you select
 File&#8209;&gt;New, <b>ePubEditor</b> will start a new publication in the working
 directory/folder you select.</p>

 <p>The "Manifest" table will show a list of all the files that will be included
 in the publication. When you start a new ePub, you should see three files in the
 manifest: ebook.css, toc.html, and cover.jpg. "toc.html" and "cover.jpg" should
 be marked with a red "stop" symbol, indicating that while they are listed in the
 the manifest they do not exist on the file system. You can remove them from the
 manifest, or better yet you can create them. Once the files exist (and the window
 is refreshed) the red "stop" will turn to a green "check."</p>

<img src="./newEPub.png" style="max-width:95vw"/>

<h5>Add</h5>

<p>On this tab there is an "Add" button. When you press this button,
 a file system browser will appear and allow you to add any file to the
 publication. When a file is added to the publication it is copied to the
 publication's working folder.</p>

<p>When you add a file to the publication, <b>ePubEditor</b> attempts to
 "intuit" its media-type based on the file extension. It then presents a dialog
 box asking if you want to add the file to the content list. If you say yes,
 the file will be flagged as being part of the content, a reference to it will
 be added to the "Content" table, and it will eventually become part of the ePub's
 &lt;spine&gt;. If the media-type is not correct, you should change it to match
 the actual media-type. Only certain media-types are allowed in ePubs, and the
 "media-type" field contains a drop-down selector containing only those media
 types. If the HTML file is XML-compliant it should have a media-type of
 "application/xhtml+xml"; otherwise, it probably has a media-type of "text/html".
 Typically, only HTML files should be added to the content list.</p>

<p>If a manifested file is deleted from the file system the Manifest entry will
 remain, but the file indicator icon will change to the red "stop" symbol when
 the screen is refreshed.</p>

<h5>Remove</h5>

<p>The "Remove" button allows you to remove a file from the publication. When
 a file is removed from the publication it is also removed from the Content
 table if it is part of the content, but it is <em>not</em> removed from the
 file system. The file will not be part of the compiled ePub, but it will remain
 in the working folder in the file system for future reference.</p>

<h5>Edit</h5>

<p>When the "Edit" button is pressed, ePubEditor attempts to launch the editor
 associated with the declared media-type. (see the <a href="#Editor">preferences
 setup</a> discussion earlier in this document.)</p>

<h5>Split HTML</h5>

<p>It is possible that you may be creating an ePub from an existing single large
 HTML file. In this case you may want to split the one large file into smaller
 files for better maintenance, such as one file per chapter. <b>ePubEditor</b>
 allows you to split up an HTML file into multiple files by specifying an HTML
 element which is a split point.</p>

<p>As an example, the Project Gutenberg version of <i>A Tale of Two Cities</i>, by
 Charles Dickens has each chapter sectioned into a &lt;div class="chapter"&gt;
 element. Suppose you add the PG file to a new ePub and set the media-type
 correctly. When you select the file and press the "Split" button you will be
 presented with a dialog box that will ask for the HTML element which will be
 the split point.</p>

<img src="TOTC-Split.png" style="max-width: 95vw"/>

<p>When you press the "Split" button you will end up with 49 new HTML files
 numbered consecutively. If the original file was part of the content, each of
 the new files will be added to the Content table as well. The original file
 will be split immediately before the selected element. Each new file will
 have the same &lt;head&gt; section (and thus all the same style data) but the body
 will contain only the text after the split point element and up to the next
 occurrence of the split point element. The original file will be removed
 from the Manifest, but it wil not be deleted from the file system.</p>

<h5>Adding publication metadata</h5>

<p>Metadata about the book can be entered or edited on the "Authors and Contributors"
 tab, or on the "Properties" tab. Every ePub must have at least one identifier which is
 globally unique, a title, and a language attribute. Once your publication is internally 
 consistent you may save it as an ePub.</p>

<h4><i>Saved for later</i></h4>
<p>Caution: if you have opened an ePub, and press "Save" your previous file will be replaced. 
If you're exploring the capabilities of the program, be sure to use "Save As..." and put your 
new file in some other location.</p>

<p>The Manifest shows all files that will become part of the publication, but
 only files listed in the "Content" will be presented directly to the reader.
 Order is unimportant in the Manifest table, but items in the Content table
 will be presented in the order they are listed. Therefore, on the Content tab
 there are buttons to move file references up and down.</p>


</body>
</html>
